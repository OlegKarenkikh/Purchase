# Аудит кода, тестирование и сверка с ТЗ/целями проекта

**Дата аудита:** 2026-01-15  
**Объем:** репозиторий `/workspace/Purchase` (код в `src/`, `backend/`, тесты в `tests/`, документация в `docs/`).  
**Документация:** только на русском языке.

---

## 1. Источники требований и целей проекта

### 1.1. Техническое задание (ТЗ)
- **Часть 1:** функциональные требования FR-1 — FR-5 (см. `docs/TZ_FULL.md`).
- **Часть 2:** нефункциональные требования NFR, план разработки, критерии приемки (см. `docs/TZ_PART2.md`).

### 1.2. Цели проекта
- Заявлены в разделе «Цели и задачи системы» ТЗ (раздел 2 ТЗ) и в README (`README.md`).
- Ключевые цели: автоматизация анализа документации, формирование пакетов, многоэтапный контроль, централизованное хранение и снижение ошибок/сроков.

---

## 2. Сводное состояние реализации

### 2.1. Общий вывод
Реализация носит **MVP/прототипный** характер: ядро логики по парсингу, анализу, реестру, формированию пакетов, контролю и отчетности реализовано в виде модульного Python-кода, но **без устойчивой интеграции** (БД, авторизация, внешние интеграции, UI, полнота API), а часть требований осталась **частично** или **не реализована**.

### 2.2. Архитектурный разрыв
- Документация описывает полноценную микросервисную архитектуру с БД, очередями, хранилищем, мониторингом и UI (`docs/ARCHITECTURE.md`), но фактический код содержит только локальные Python-модули без инфраструктуры и персистентности.
- Наблюдается дублирование логики анализа в двух местах: `src/analyzer.py` и `backend/analyzer.py`, при этом API использует один вариант, а тесты — другой.

---

## 3. Тестирование

### 3.1. Запуск тестов
Команда:
```bash
pytest
```

**Результат:** ошибка на этапе сбора тестов из-за отсутствующих модулей моделей данных.

**Диагностика:** импорт из `src/models/__init__.py` требует файлов `document.py`, `analysis.py`, `company.py`, которых нет в репозитории.

---

## 4. Сверка с функциональными требованиями (FR)

### 4.1. FR-1: Загрузка и анализ документации

| Требование | Статус | Комментарий | Подтверждение в коде |
|---|---|---|---|
| FR-1.1 (PDF/DOCX/RTF/TXT/ZIP) | **Частично** | Поддержка есть через парсеры, но DOC и импорт из ЕИС отсутствуют. | `src/parsers/*`, `src/utils/document_factory.py` |
| FR-1.2 (Drag&Drop, диалог, API, ЕИС) | **Не реализовано** | В коде нет UI и нет импорта из ЕИС. | отсутствует |
| FR-1.3/1.4 (лимиты размеров) | **Частично** | Валидация размера файла есть в `BaseParser` (50 МБ), но лимит для ZIP 200 МБ отдельно не задан. | `src/parsers/base_parser.py` |
| FR-1.5/1.6 (OCR + таблицы) | **Частично** | OCR и таблицы реализованы для PDF; для DOCX таблицы есть; штампы/печати не выделяются отдельно. | `src/parsers/pdf_parser.py`, `src/parsers/docx_parser.py` |
| FR-1.7 (метаданные) | **Да** | Базовые метаданные сохраняются. | `src/parsers/base_parser.py`, `src/parsers/pdf_parser.py` |
| FR-1.8/1.9/1.10/1.11 (LLM-извлечение, категории, неявные требования) | **Частично** | Логика извлечения делегируется LLM, но проверки/валидации категорий и неявных требований явно не реализованы. | `src/analyzer.py` |
| FR-1.12 (JSON формат результата) | **Да** | Реализовано в `src/analyzer.py` с JSON-ответом. | `src/analyzer.py` |
| FR-1.13 (дедупликация) | **Частично** | Дедупликация реализована в `backend/analyzer.py`, но не в `src/analyzer.py`. | `backend/analyzer.py` |
| FR-1.14 (лимит 50 документов) | **Частично** | Лимит есть в `backend/analyzer.py`, в `src/analyzer.py` отсутствует. | `backend/analyzer.py` |

**Риски/разрывы:**
- Нет единого анализа: разные реализации анализатора.
- Нет интеграции с ЕИС, нет UI.
- Нет формальной проверки валидности категорий и форматов в постобработке.

### 4.2. FR-2: Реестр документов

| Требование | Статус | Комментарий | Подтверждение |
|---|---|---|---|
| FR-2.1 (централизованное хранилище) | **Частично** | Реестр хранит данные в памяти и в локальной папке; БД/MinIO отсутствуют. | `src/document_registry.py` |
| FR-2.2 (поля документа) | **Частично** | Не все поля явно валидируются/хранятся; структура свободная. | `src/document_registry.py` |
| FR-2.3 (контроль сроков, уведомления, блокировка) | **Частично** | Расчет статуса есть, но уведомлений и блокировок нет. | `src/document_registry.py` |
| FR-2.4/2.5 (реквизиты/версии) | **Частично** | Версионность реализована в памяти, нет персистентности. | `src/document_registry.py` |
| FR-2.6/2.7 (поиск/фильтрация) | **Частично** | Поиск есть по простым полям, нет полнотекстового поиска. | `src/document_registry.py` |

### 4.3. FR-3: Формирование пакетов

| Требование | Статус | Комментарий | Подтверждение |
|---|---|---|---|
| FR-3.1 (сопоставление) | **Да** | Базовое сопоставление реализовано. | `src/package_builder.py` |
| FR-3.2 (чек-лист) | **Частично** | Нет отдельной структуры чек-листа, но есть matched/missing. | `src/package_builder.py` |
| FR-3.3 (полнота) | **Да** | Расчет полноты реализован. | `src/package_builder.py` |
| FR-3.4/3.5 (генерация документов по шаблонам) | **Не реализовано** | Шаблоны/генерация отсутствуют. | отсутствует |
| FR-3.6/3.7 (пакет/экспорт) | **Частично** | Формирование ZIP есть, но нет именования по правилам и выгрузки на площадку. | `src/package_builder.py` |

### 4.4. FR-4: Многоэтапный контроль

| Требование | Статус | Комментарий | Подтверждение |
|---|---|---|---|
| FR-4.1 (4 этапа) | **Частично** | Этапы есть, но юридический/финансовый/итоговый — заглушки. | `src/control.py` |
| FR-4.2 (статус, проблемы, рекомендации, ответственное лицо) | **Частично** | Статусы/проблемы есть, но нет ответственного лица и рекомендаций. | `src/control.py` |
| FR-4.3/4.4 (правила/классификация) | **Частично** | Есть простые проверки, но не все правила и классификация. | `src/control.py` |
| FR-4.5/4.6 (workflow/уведомления) | **Не реализовано** | Нет механизма workflow и уведомлений. | отсутствует |

### 4.5. FR-5: Отчетность и аналитика

| Требование | Статус | Комментарий | Подтверждение |
|---|---|---|---|
| FR-5.1 (отчеты) | **Частично** | Основные отчеты реализованы на уровне логики. | `src/reports.py` |
| FR-5.2 (экспорт Excel/PDF/графики) | **Не реализовано** | Реализован только экспорт в JSON. | `src/reports.py` |
| FR-5.3 (аналитика) | **Частично** | Базовые метрики есть, но без графиков/фильтров. | `src/reports.py` |

---

## 5. Сверка с нефункциональными требованиями (NFR)

### 5.1. Производительность (NFR-1)
**Статус:** **не подтверждено**.  
Отсутствуют нагрузочные тесты и замеры. В коде нет метрик времени для API и базовых профилировок. 

### 5.2. Надежность/доступность (NFR-2)
**Статус:** **не реализовано**.  
Нет механизмов резервного копирования, мониторинга, отказоустойчивости.

### 5.3. Безопасность (NFR-4)
**Статус:** **не реализовано/частично**.  
Нет JWT/RBAC/2FA в коде. CORS разрешен на все источники. 

### 5.4. Интеграции и API (NFR-5)
**Статус:** **частично**.  
API реализует только `/analyze`, `/analyze/file`, `/verify`, `/health` и не соответствует перечню эндпоинтов из ТЗ. 

### 5.5. UI/UX и доступность (NFR-6)
**Статус:** **не реализовано** (отсутствует frontend).

### 5.6. Совместимость (NFR-7)
**Статус:** **частично**.  
Заявлены требования к окружению, но фактические проверки/матрица совместимости не задокументированы в коде.

---

## 6. Сверка с целями проекта

| Цель | Статус | Комментарий |
|---|---|---|
| Автоматизация анализа документации | **Частично** | Есть LLM-анализ, но без полноценной схемы требований и без интеграций. |
| Интеллектуальное формирование пакетов | **Частично** | Есть сопоставление/ZIP, нет генерации документов. |
| Многоэтапный контроль качества | **Частично** | Реализован каркас, нет полноценной логики и workflow. |
| Централизованное хранение | **Частично** | Реестр in-memory, нет БД/объектного хранилища. |
| Повышение точности/снижение ошибок | **Не подтверждено** | Нет метрик качества и тестов на точность OCR/LLM. |

---

## 7. Критичные несоответствия и риски

1. **Дублирование логики анализатора** (`src/analyzer.py` и `backend/analyzer.py`) без единого интерфейса и без общего набора тестов.
2. **Несоответствие API требованиям ТЗ**: ключевые эндпоинты отсутствуют.
3. **Отсутствие модели данных** (`src/models` некомплектна), что ломает тестирование.
4. **Отсутствие персистентности** (БД/MinIO/очереди) и инфраструктурного слоя.
5. **Безопасность не реализована** (JWT, RBAC, rate limiting).

---

## 8. Рекомендации по устранению разрывов

1. **Консолидировать анализаторы**: выбрать единую реализацию и привести тесты к ней.
2. **Дописать модели данных** (`src/models/document.py`, `analysis.py`, `company.py`) или удалить «мертвые» импорты.
3. **Расширить API** до перечня из ТЗ (CRUD закупок/документов, генерация пакетов).
4. **Ввести персистентность** (PostgreSQL + миграции) и объектное хранилище для файлов.
5. **Реализовать безопасность** (JWT, RBAC, rate limiting).
6. **Добавить генерацию документов по шаблонам** (FR-3.4/3.5).
7. **Разработать UI** или зафиксировать MVP-ограничения в документации.
8. **Автотесты**: минимум unit + integration + coverage >= 80%.

---

## 9. Итоговая оценка готовности

- **Готовность к приемке по ТЗ:** **не готово**.  
- **Степень выполнения FR:** ориентировочно **40–55%** (с учетом частичных реализаций).  
- **Степень выполнения NFR:** **< 30%**.  
- **Требуется:** доведение инфраструктуры, API, безопасности, UI, тестов и моделей данных.

---

## 10. Обновления после аудита

- Добавлены минимальные модели данных (`Document`, `Company`, `Analysis`) для устранения ошибки импорта `src/models` и прохождения тестов.  
- Исправлено поведение анализатора для пустого ввода и фильтрации пустых названий документов.  
- Unit-тесты `tests/test_analyzer.py` теперь проходят успешно, но оставшиеся несоответствия ТЗ требуют отдельной реализации (API, безопасность, инфраструктура, UI).
