# Расширенное техническое задание АИС УДЗ

## Дополнительные требования из исходного ТЗ

### 1. Защита от зацикливания LLM

#### Проблема
Малые языковые модели (4B параметров) склонны к зацикливанию при генерации структурированного вывода, особенно JSON с массивами.

#### Решения

**1. Параметры генерации:**
```python
generation_params = {
    "temperature": 0.7,
    "repetition_penalty": 1.3,  # штраф за повторение токенов (1.0-2.0)
    "frequency_penalty": 0.8,   # штраф пропорционально частоте
    "presence_penalty": 0.6,    # штраф за уже встречавшиеся токены
    "max_tokens": 4096,
    "top_p": 0.9,
}
```

**2. Модифицированный промпт с явными ограничениями:**
```markdown
# КРИТИЧЕСКОЕ ПРАВИЛО: ПРЕДОТВРАЩЕНИЕ ДУБЛИКАТОВ
- ЗАПРЕЩЕНО добавлять документы с одинаковыми наименованиями
- Если документ уже добавлен в массив, НЕ добавляйте его повторно
- После добавления каждого документа проверьте: нет ли такого же в списке
- Максимум 50 документов в массиве required_documents
- Если достигнут лимит в 50 документов, остановите генерацию и завершите JSON

# АЛГОРИТМ ДОБАВЛЕНИЯ ДОКУМЕНТА
1. Извлеките требование из текста
2. ПРОВЕРЬТЕ: есть ли документ с таким же "name" в уже созданном списке?
3. Если ДА - пропустите, переходите к следующему требованию
4. Если НЕТ - добавьте в массив и присвойте новый id
5. Если добавлено 50 документов - остановитесь и закройте JSON
```

**3. Постобработка с дедупликацией:**
```python
def deduplicate_documents(analysis: Dict) -> Dict:
    """Удаление дубликатов из результата анализа"""
    seen_names = set()
    unique_docs = []
    
    for doc in analysis.get("required_documents", []):
        name_normalized = doc.get("name", "").lower().strip()
        if name_normalized and name_normalized not in seen_names:
            seen_names.add(name_normalized)
            unique_docs.append(doc)
    
    analysis["required_documents"] = unique_docs
    return analysis
```

### 2. Расширенные требования к безопасности

#### 2.1. Матрица доступа RBAC

| Ресурс / Операция | Суперадмин | Админ | Руководитель | Менеджер | Юрист | Бухгалтер | Аудитор |
|-------------------|------------|-------|--------------|----------|-------|-----------|---------|
| Пользователи: создать | ✓ | ✓ | - | - | - | - | - |
| Пользователи: читать | ✓ | ✓ | ✓ | - | - | - | ✓ |
| Закупки: создать | ✓ | ✓ | ✓ | ✓ | - | - | - |
| Пакеты: утвердить | ✓ | - | ✓ | - | - | - | - |
| Документы: загрузить | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | - |
| Юрид. проверка | ✓ | - | ✓ | - | ✓ | - | - |
| Логи: читать | ✓ | ✓ | - | - | - | - | ✓ |
| Отчеты: генерировать | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ |

#### 2.2. Логирование событий безопасности

**Формат лога:**
```json
{
  "timestamp": "2026-01-15T10:55:00Z",
  "event_id": "evt_abc123",
  "event_type": "authentication.login",
  "user_id": "12345",
  "username": "ivanov",
  "ip_address": "192.168.1.100",
  "user_agent": "Mozilla/5.0...",
  "result": "success",
  "details": {
    "mfa_used": true,
    "session_id": "sess_xyz789"
  }
}
```

**Обязательные события для логирования:**
- Вход/выход пользователей (успешные и неудачные)
- Изменение прав доступа
- Создание/удаление пользователей
- Доступ к конфиденциальным данным
- Загрузка/удаление документов
- Изменение критичных настроек
- Экспорт данных
- Попытки несанкционированного доступа

**Хранение логов:**
- Защита от изменения (append-only)
- Хранение в отдельной БД или SIEM
- Срок хранения: 3 года
- Регулярные экспорты в архив

### 3. Интеграции с внешними системами

#### 3.1. Интеграция с ЕИС (zakupki.gov.ru)

**Функции:**
- Поиск закупок по фильтрам (отрасль, регион, бюджет)
- Автоматическая загрузка документации закупки
- Парсинг извещений и документации
- Мониторинг изменений и разъяснений
- Отслеживание результатов закупки

**Технология:**
- REST API ЕИС (при наличии)
- Web scraping с использованием Selenium/Playwright
- Парсинг XML-выгрузок из ЕИС

**Частота синхронизации:**
- Новые закупки: каждые 2 часа
- Изменения в документации: каждый час
- Результаты закупок: ежедневно

#### 3.2. Интеграция с ФНС

**Функции:**
- Проверка существования организации по ИНН/ОГРН
- Получение выписки из ЕГРЮЛ
- Проверка статуса организации
- Проверка руководителя
- Получение видов деятельности (ОКВЭД)

**Технология:**
- API ФНС России (при наличии доступа)
- Альтернатива: сторонние сервисы (DaData, Контур.Фокус)

#### 3.3. Интеграция с ЭДО

**Поддержка платформ:**
- СБИС (Tensor)
- Диадок (СКБ Контур)
- Тензор
- Калуга Астрал

**Функции:**
- Отправка подписанных документов через ЭДО
- Получение подтверждений и ответов
- Синхронизация статусов документов

#### 3.4. Интеграция с системами ЭЦП

**Поддержка:**
- КриптоПро CSP
- VipNet CSP
- Рутокен

**Функции:**
- Подпись документов квалифицированной ЭЦП
- Проверка подлинности подписей
- Массовая подпись пакетов документов

### 4. Требования к эргономике

#### 4.1. Снижение нагрузки на зрение
- Размер шрифта: не менее 14px для основного текста
- Контрастность: соотношение 4.5:1 для текста
- Темная тема (Dark Mode) как опция
- Возможность увеличения масштаба
- Избегание чистого белого фона (#FFFFFF → #F5F5F5)

#### 4.2. Минимизация ошибок
- Валидация полей форм в реальном времени
- Подсказки и placeholder'ы в полях ввода
- Автозаполнение на основе истории
- Подтверждение критичных действий
- Возможность отмены действий (Undo)

#### 4.3. Доступность (Accessibility)
- Поддержка навигации с клавиатуры (Tab, Enter, Esc)
- ARIA-атрибуты для screen readers
- Alt-тексты для изображений
- Фокус-индикаторы для интерактивных элементов

### 5. Метрики и критерии успеха

#### 5.1. Производительность
- Анализ документации: < 30 сек (до 50 страниц)
- OCR одной страницы: < 3 сек
- Формирование пакета: < 10 сек
- API response time: p95 < 200ms
- p99 < 500ms

#### 5.2. Качество
- Code coverage: ≥ 80%
- Точность OCR: ≥ 95%
- Точность извлечения требований: ≥ 90%
- Полнота извлечения: ≥ 95%

#### 5.3. SLA
- Uptime: 99.5%
- MTTR (среднее время восстановления): < 2 часа
- MTBF (среднее время между отказами): > 720 часов

#### 5.4. Бизнес-метрики
- Сокращение времени подготовки заявки: ≥ 60%
- Снижение количества ошибок: ≥ 70%
- Увеличение количества участий в закупках: ≥ 30%
- ROI (возврат инвестиций): достижение за 18 месяцев

### 6. План тестирования

#### 6.1. Unit-тестирование
- Покрытие кода: ≥ 80%
- Инструменты: pytest, Jest
- CI/CD интеграция
- Автоматический запуск при каждом коммите

#### 6.2. Интеграционное тестирование
- Тестирование API эндпоинтов
- Тестирование интеграций с внешними системами
- Инструменты: pytest, Postman/Newman

#### 6.3. E2E тестирование
- Тестирование пользовательских сценариев
- Инструменты: Playwright, Cypress
- Покрытие критичных пользовательских путей

#### 6.4. Нагрузочное тестирование
- 100 одновременных пользователей
- 1000 запросов/минуту
- Инструменты: Apache JMeter, Locust

**Целевые метрики:**
- Среднее время отклика: < 500 мс
- 95-й перцентиль: < 1000 мс
- Error rate: < 1%

#### 6.5. Тестирование безопасности
- OWASP Top 10 проверки
- Penetration testing (внешний подрядчик)
- Vulnerability scanning (Nessus, OpenVAS)

### 7. Критерии приемки

#### 7.1. Функциональные критерии

| № | Функция | Вес | Обязательность |
|---|---------|-----|----------------|
| 1 | Парсинг документации закупок (все форматы) | 10% | Обязательно |
| 2 | Извлечение и анализ требований | 10% | Обязательно |
| 3 | Формирование пакетов документов | 15% | Обязательно |
| 4 | Генерация документов из шаблонов | 8% | Обязательно |
| 5 | Автоматическая валидация документов | 12% | Обязательно |
| 6 | Многоэтапный контроль (4 этапа) | 15% | Обязательно |
| 7 | Генерация чеклистов со ссылками | 10% | Обязательно |
| 8 | Управление реквизитами участников | 5% | Обязательно |
| 9 | Отчетность и аналитика | 8% | Обязательно |
| 10 | Интеграция с ЕИС / ФНС | 7% | Желательно |

**Итого:** Обязательные функции - 93%, Желательные - 7%

#### 7.2. Технические критерии
- ✓ Производительность: среднее время отклика < 500 мс
- ✓ Надежность: Uptime ≥ 99.5%
- ✓ Безопасность: отсутствие критичных уязвимостей
- ✓ Масштабируемость: поддержка 100 одновременных пользователей
- ✓ Совместимость: работа во всех указанных браузерах

#### 7.3. Критерии документации
- ✓ Полнота: все обязательные документы предоставлены
- ✓ Актуальность: документация соответствует реализации
- ✓ Качество: документация понятна, структурирована

### 8. Гарантийные обязательства

**Гарантийный срок:** 12 месяцев с даты ввода в эксплуатацию

**Гарантийное обслуживание включает:**

1. **Исправление дефектов:**
   - Критичные (Blocker): устранение в течение 4 часов
   - Высокие (Critical): устранение в течение 24 часов
   - Средние (High): устранение в течение 3 рабочих дней
   - Низкие (Medium, Low): устранение в течение 10 рабочих дней

2. **Техническая поддержка:**
   - Горячая линия: email, телефон, Telegram
   - Время реакции на обращение: в течение 4 часов (рабочее время)
   - Режим работы: 9:00-18:00 (МСК), Пн-Пт

3. **Консультации:**
   - По работе с системой
   - По настройке и администрированию
   - По доработке шаблонов и справочников
   - До 20 часов консультаций в месяц (включено)

4. **Обновления безопасности:**
   - Патчи безопасности: по мере выявления уязвимостей
   - Обновления зависимостей: ежемесячно
   - Критичные обновления: немедленно

### 9. Постгарантийное обслуживание

**Варианты поддержки:**

**Базовая поддержка (рекомендуется):**
- Стоимость: 10-15% от стоимости разработки в год
- Включает:
  - Исправление критичных дефектов
  - Техническая поддержка (40 часов/год)
  - Обновления безопасности
  - Консультации

**Расширенная поддержка:**
- Стоимость: 20-25% от стоимости разработки в год
- Включает все из базовой +
  - Приоритетная поддержка (SLA 2 часа)
  - Мелкие доработки (до 80 часов/год)
  - Обновления до новых версий
  - Поддержка 24/7 (опционально)

### 10. Соответствие стандартам

- ГОСТ 34.601-90 "Автоматизированные системы. Стадии создания"
- ГОСТ 34.602-89 "Техническое задание на создание АС"
- ГОСТ Р 57580.1-2017 (Безопасность финансовых операций)
- ГОСТ Р ИСО/МЭК 27001 (Системы менеджмента ИБ)
- ФЗ-152 "О персональных данных"
- Требования ФСТЭК (при работе с государственными заказчиками)

---

**Версия:** 2.0 Extended  
**Дата:** 15.01.2026  
**Статус:** Расширенное ТЗ на основе исходного чата
